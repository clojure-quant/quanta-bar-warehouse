# Transform
## append-only

```clojure
(:require    
  [tick.core :as t]
  [missionary.core :as m]
  [ta.db.bars.protocol :as b]
  [dev.env :refer [bar-engine]]
  [quanta.bar.preload :refer [import-bars]])
```


### init data (day)
```clojure
(m/? (import-bars
       bar-engine
       {:asset "BTCUSDT"
        :calendar [:crypto :d]
        :import :bybit-parallel
        :to :nippy
        :window {:start (t/instant "2024-08-01T00:01:00Z")
                 :end (t/instant "2024-09-08T00:00:00Z")}
        :label "import bybit :d"}))

(m/?
  (b/get-bars bar-engine
              {:asset "BTCUSDT"
               :calendar [:crypto :d]
               :bardb :nippy}
              {}))
```

```console
;=> _unnamed [38 7]:
;
;|                :date |    :open |    :high |     :low |   :close |      :volume |  :asset |
;|----------------------|---------:|---------:|---------:|---------:|-------------:|---------|
;| 2024-08-02T00:00:00Z | 64631.66 | 65664.17 | 62276.07 | 65359.52 | 26649.072201 | BTCUSDT |
;| 2024-08-03T00:00:00Z | 65359.52 | 65604.69 | 61220.51 | 61492.70 | 30995.032601 | BTCUSDT |
;| 2024-08-04T00:00:00Z | 61492.70 | 62195.44 | 59845.00 | 60706.71 | 24048.623913 | BTCUSDT |
;| 2024-08-05T00:00:00Z | 60706.71 | 61117.99 | 57141.00 | 58165.87 | 22629.787445 | BTCUSDT |
;| 2024-08-06T00:00:00Z | 58165.87 | 58308.01 | 48974.00 | 54024.47 | 83370.985286 | BTCUSDT |
;| 2024-08-07T00:00:00Z | 54024.47 | 57078.28 | 53946.16 | 56019.93 | 29868.423264 | BTCUSDT |
;| 2024-08-08T00:00:00Z | 56019.93 | 57753.00 | 54548.70 | 55143.12 | 24187.586582 | BTCUSDT |
;| 2024-08-09T00:00:00Z | 55143.12 | 62745.45 | 54736.64 | 61686.97 | 26074.519089 | BTCUSDT |
;| 2024-08-10T00:00:00Z | 61686.97 | 61757.07 | 59520.53 | 60845.02 | 22877.550585 | BTCUSDT |
;| 2024-08-11T00:00:00Z | 60845.02 | 61484.99 | 60240.58 | 60923.71 | 22990.614685 | BTCUSDT |
;|                  ... |      ... |      ... |      ... |      ... |          ... |     ... |
;| 2024-08-29T00:00:00Z | 59411.08 | 60257.77 | 57801.54 | 59044.69 | 23996.944745 | BTCUSDT |
;| 2024-08-30T00:00:00Z | 59044.69 | 61175.07 | 58703.08 | 59348.57 | 18827.563337 | BTCUSDT |
;| 2024-08-31T00:00:00Z | 59348.57 | 59944.16 | 57700.00 | 59130.23 | 19456.016647 | BTCUSDT |
;| 2024-09-01T00:00:00Z | 59130.23 | 59463.00 | 58736.42 | 58972.48 |  7176.997611 | BTCUSDT |
;| 2024-09-02T00:00:00Z | 58972.48 | 59080.67 | 57162.76 | 57293.29 | 16960.761333 | BTCUSDT |
;| 2024-09-03T00:00:00Z | 57293.29 | 59432.74 | 57124.21 | 59142.75 | 23098.259720 | BTCUSDT |
;| 2024-09-04T00:00:00Z | 59142.75 | 59825.00 | 57401.01 | 57481.78 | 20902.434172 | BTCUSDT |
;| 2024-09-05T00:00:00Z | 57481.78 | 58526.02 | 55566.05 | 57972.69 | 30443.293677 | BTCUSDT |
;| 2024-09-06T00:00:00Z | 57972.69 | 58333.08 | 55632.01 | 56177.67 | 28363.931568 | BTCUSDT |
;| 2024-09-07T00:00:00Z | 56177.67 | 57018.51 | 52535.50 | 53961.62 | 33299.004330 | BTCUSDT |
;| 2024-09-08T00:00:00Z | 53961.62 | 54851.34 | 53750.02 | 54164.51 | 22779.134421 | BTCUSDT |
```

### append data (+ 6 days)
```clojure
(m/?
  (b/get-bars bar-engine
              {:asset "BTCUSDT"
               :calendar [:crypto :d]
               :bardb :nippy
               :to :nippy
               :import :bybit-parallel
               :transform :append-only}
              {:start (t/instant "2024-08-25T00:00:00Z")
               :end (t/instant "2024-09-15T00:00:00Z")}))
```

```console
;=> _unnamed [22 7]:
;
;|                :date |    :open |    :high |     :low |   :close |      :volume |  :asset |
;|----------------------|---------:|---------:|---------:|---------:|-------------:|---------|
;| 2024-08-25T00:00:00Z | 64046.30 | 64500.00 | 63543.28 | 64153.50 | 19546.945175 | BTCUSDT |
;| 2024-08-26T00:00:00Z | 64153.50 | 65032.12 | 63780.00 | 64218.10 | 18111.952814 | BTCUSDT |
;| 2024-08-27T00:00:00Z | 64218.10 | 64479.22 | 62796.41 | 62834.75 | 26594.582272 | BTCUSDT |
;| 2024-08-28T00:00:00Z | 62834.75 | 63213.07 | 57955.58 | 59411.08 | 33807.337927 | BTCUSDT |
;| 2024-08-29T00:00:00Z | 59411.08 | 60257.77 | 57801.54 | 59044.69 | 23996.944745 | BTCUSDT |
;| 2024-08-30T00:00:00Z | 59044.69 | 61175.07 | 58703.08 | 59348.57 | 18827.563337 | BTCUSDT |
;| 2024-08-31T00:00:00Z | 59348.57 | 59944.16 | 57700.00 | 59130.23 | 19456.016647 | BTCUSDT |
;| 2024-09-01T00:00:00Z | 59130.23 | 59463.00 | 58736.42 | 58972.48 |  7176.997611 | BTCUSDT |
;| 2024-09-02T00:00:00Z | 58972.48 | 59080.67 | 57162.76 | 57293.29 | 16960.761333 | BTCUSDT |
;| 2024-09-03T00:00:00Z | 57293.29 | 59432.74 | 57124.21 | 59142.75 | 23098.259720 | BTCUSDT |
;|                  ... |      ... |      ... |      ... |      ... |          ... |     ... |
;| 2024-09-05T00:00:00Z | 57481.78 | 58526.02 | 55566.05 | 57972.69 | 30443.293677 | BTCUSDT |
;| 2024-09-06T00:00:00Z | 57972.69 | 58333.08 | 55632.01 | 56177.67 | 28363.931568 | BTCUSDT |
;| 2024-09-07T00:00:00Z | 56177.67 | 57018.51 | 52535.50 | 53961.62 | 33299.004330 | BTCUSDT |
;| 2024-09-08T00:00:00Z | 53961.62 | 54851.34 | 53750.02 | 54164.51 | 22779.134421 | BTCUSDT |
;| 2024-09-09T00:00:00Z | 54164.51 | 55324.49 | 53628.06 | 54877.92 | 14830.880938 | BTCUSDT |
;| 2024-09-10T00:00:00Z | 54877.92 | 58130.24 | 54591.47 | 57039.58 | 21486.315072 | BTCUSDT |
;| 2024-09-11T00:00:00Z | 57039.58 | 58052.21 | 56383.76 | 57643.48 | 25482.208587 | BTCUSDT |
;| 2024-09-12T00:00:00Z | 57643.48 | 57991.00 | 55555.00 | 57334.15 | 26867.906044 | BTCUSDT |
;| 2024-09-13T00:00:00Z | 57334.15 | 58582.80 | 57318.13 | 58134.02 | 24532.880423 | BTCUSDT |
;| 2024-09-14T00:00:00Z | 58134.02 | 60628.71 | 57627.44 | 60486.46 | 27348.341105 | BTCUSDT |
;| 2024-09-15T00:00:00Z | 60486.46 | 60605.59 | 59381.96 | 59993.99 | 10879.880909 | BTCUSDT |
```

### init data (minutes)
```clojure
(m/? (import-bars
      bar-engine
      {:asset "BTCUSDT"
       :calendar [:crypto :m]
       :import :bybit-parallel
       :to :nippy
       :window {:start (t/instant "2024-08-01T00:01:00Z")
                :end (t/instant "2024-09-08T00:00:00Z")}
       :label "import bybit :m"}))
```

```console
;=> _unnamed [54720 7]:
;
;|                :date |    :open |    :high |     :low |   :close |   :volume |  :asset |
;|----------------------|---------:|---------:|---------:|---------:|----------:|---------|
;| 2024-08-01T00:01:00Z | 64631.66 | 64681.04 | 64602.43 | 64634.26 | 22.534596 | BTCUSDT |
;| 2024-08-01T00:02:00Z | 64634.26 | 64691.09 | 64620.67 | 64671.30 | 13.958742 | BTCUSDT |
;| 2024-08-01T00:03:00Z | 64671.30 | 64703.44 | 64622.29 | 64623.85 | 13.145399 | BTCUSDT |
;| 2024-08-01T00:04:00Z | 64623.85 | 64700.55 | 64623.85 | 64687.91 | 16.006270 | BTCUSDT |
;| 2024-08-01T00:05:00Z | 64687.91 | 64710.94 | 64674.54 | 64679.51 | 11.166516 | BTCUSDT |
;| 2024-08-01T00:06:00Z | 64679.51 | 64744.75 | 64679.51 | 64744.75 |  8.044719 | BTCUSDT |
;| 2024-08-01T00:07:00Z | 64744.75 | 64780.50 | 64729.61 | 64780.49 |  8.742001 | BTCUSDT |
;| 2024-08-01T00:08:00Z | 64780.49 | 64794.80 | 64727.72 | 64735.00 | 17.130190 | BTCUSDT |
;| 2024-08-01T00:09:00Z | 64735.00 | 64761.00 | 64675.85 | 64723.95 | 16.429661 | BTCUSDT |
;| 2024-08-01T00:10:00Z | 64723.95 | 64788.93 | 64720.41 | 64786.35 | 13.307908 | BTCUSDT |
;|                  ... |      ... |      ... |      ... |      ... |       ... |     ... |
;| 2024-09-07T23:50:00Z | 54107.04 | 54117.41 | 54099.73 | 54113.32 |  7.698892 | BTCUSDT |
;| 2024-09-07T23:51:00Z | 54113.32 | 54145.99 | 54094.94 | 54139.98 | 21.830693 | BTCUSDT |
;| 2024-09-07T23:52:00Z | 54139.98 | 54176.68 | 54139.98 | 54155.16 |  8.630863 | BTCUSDT |
;| 2024-09-07T23:53:00Z | 54155.16 | 54155.16 | 54129.34 | 54149.61 | 10.728079 | BTCUSDT |
;| 2024-09-07T23:54:00Z | 54149.61 | 54149.98 | 54107.00 | 54107.00 |  7.484142 | BTCUSDT |
;| 2024-09-07T23:55:00Z | 54107.00 | 54192.23 | 54104.00 | 54174.11 | 25.524945 | BTCUSDT |
;| 2024-09-07T23:56:00Z | 54174.11 | 54195.52 | 54165.77 | 54176.00 | 11.268023 | BTCUSDT |
;| 2024-09-07T23:57:00Z | 54176.00 | 54176.00 | 54146.79 | 54146.80 |  9.413673 | BTCUSDT |
;| 2024-09-07T23:58:00Z | 54146.80 | 54174.00 | 54146.79 | 54148.01 | 12.154609 | BTCUSDT |
;| 2024-09-07T23:59:00Z | 54148.01 | 54181.99 | 54145.14 | 54181.99 |  7.293840 | BTCUSDT |
;| 2024-09-08T00:00:00Z | 54181.99 | 54181.99 | 54148.01 | 54164.51 | 14.264258 | BTCUSDT |
```

### append data :m -> :m5
```clojure
(m/?
  (b/get-bars bar-engine
              {:asset "BTCUSDT"
               :calendar [:crypto :m5]
               :bardb :nippy
               :to :nippy
               :import :bybit-parallel
               :transform :append-only}
              {:start (t/instant "2024-09-07T23:57:00Z")
               :end (t/instant "2024-09-08T01:14:00Z")}))
```

NOTE: requested source bars from 2024-09-07T23:56:00
```console
=> _unnamed [15 8]:

|                :date |    :open |    :high |     :low |   :close |   :volume | :count |  :asset |
|----------------------|---------:|---------:|---------:|---------:|----------:|-------:|---------|
| 2024-09-08T00:00:00Z | 54174.11 | 54195.52 | 54145.14 | 54164.51 | 54.394403 |      5 | BTCUSDT |
| 2024-09-08T00:05:00Z | 54164.51 | 54187.99 | 54120.02 | 54124.87 | 63.601270 |      5 | BTCUSDT |
| 2024-09-08T00:10:00Z | 54124.87 | 54137.99 | 54058.77 | 54075.99 | 62.012618 |      5 | BTCUSDT |
| 2024-09-08T00:15:00Z | 54075.99 | 54127.08 | 54068.02 | 54118.11 | 45.074275 |      5 | BTCUSDT |
| 2024-09-08T00:20:00Z | 54118.11 | 54165.99 | 54096.64 | 54107.00 | 72.222221 |      5 | BTCUSDT |
| 2024-09-08T00:25:00Z | 54107.00 | 54150.52 | 54101.00 | 54131.18 | 62.235117 |      5 | BTCUSDT |
| 2024-09-08T00:30:00Z | 54131.18 | 54145.99 | 54070.01 | 54070.01 | 49.886625 |      5 | BTCUSDT |
| 2024-09-08T00:35:00Z | 54070.01 | 54106.34 | 54037.33 | 54094.31 | 64.103904 |      5 | BTCUSDT |
| 2024-09-08T00:40:00Z | 54094.31 | 54116.46 | 54050.66 | 54107.98 | 50.716418 |      5 | BTCUSDT |
| 2024-09-08T00:45:00Z | 54107.98 | 54141.29 | 54004.00 | 54008.99 | 46.130988 |      5 | BTCUSDT |
| 2024-09-08T00:50:00Z | 54008.99 | 54060.92 | 53966.01 | 54054.01 | 74.781149 |      5 | BTCUSDT |
| 2024-09-08T00:55:00Z | 54054.01 | 54147.70 | 54044.00 | 54147.70 | 33.862607 |      5 | BTCUSDT |
| 2024-09-08T01:00:00Z | 54147.70 | 54187.02 | 54131.02 | 54145.93 | 52.570700 |      5 | BTCUSDT |
| 2024-09-08T01:05:00Z | 54145.93 | 54204.87 | 54131.01 | 54203.31 | 40.843518 |      5 | BTCUSDT |
| 2024-09-08T01:10:00Z | 54203.31 | 54307.50 | 54201.09 | 54287.13 | 87.374030 |      5 | BTCUSDT |
```